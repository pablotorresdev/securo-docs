# CU42 - ABM CONFIGURACION DEL SISTEMA

**Caso de Uso:** Administracion de Parametros del Sistema
**URL Base:** `/admin/configuracion`
**Tipo:** ABM (Alta/Baja/Modificacion de parametros)
**Categoria:** Admin (color rojo)
**Identificador Interno:** `CU42_CONFIGURACION_SISTEMA`

---

## 1. DESCRIPCION

Permite gestionar los parametros configurables del sistema Conitrack sin necesidad de modificar archivos de configuracion ni reiniciar el servidor. Los cambios se aplican inmediatamente gracias a un sistema de cache en memoria.

**Caracteristicas principales:**
- Configuracion dinamica sin reinicio (excepto parametros marcados)
- Cache en memoria (ConcurrentHashMap) con actualizacion automatica
- Agrupacion por categorias: security, lotes, audit, backup, ui
- Validacion tipada segun tipo de dato (INTEGER, BOOLEAN, ENUM, etc.)
- Indicadores visuales: Modificado, Solo lectura, Requiere reinicio
- Restauracion individual o masiva a valores por defecto
- Auditoria completa via Hibernate Envers + logs

**Importancia en el Sistema:**
La configuracion centralizada permite ajustar politicas de seguridad sin codigo, definir alertas y umbrales operativos, cumplir requisitos ANMAT de configurabilidad, y mantener trazabilidad de cambios de configuracion.

---

## 2. ROLES AUTORIZADOS

| Rol | Nivel | Acceso |
|-----|-------|--------|
| ADMIN | 6 | Permitido |
| DT | 5 | No permitido |
| GERENTE_GARANTIA_CALIDAD | 4 | No permitido |
| GERENTE_CONTROL_CALIDAD | 3 | No permitido |
| SUPERVISOR_PLANTA | 3 | No permitido |
| ANALISTA_CONTROL_CALIDAD | 2 | No permitido |
| ANALISTA_PLANTA | 2 | No permitido |
| AUDITOR | 1 | No permitido |

**Anotacion:** No usa `@PreAuthorize` en el controller; el acceso se controla via `SecurityConfig` que itera sobre `PermisosCasoUsoEnum`.

**Referencia:** `PermisosCasoUsoEnum.CU42_CONFIGURACION_SISTEMA`

```java
CU42_CONFIGURACION_SISTEMA(
    "Configuracion del sistema",
    "/admin/configuracion",
    List.of(RoleEnum.ADMIN)
),
```

---

## 3. FLUJO DE PANTALLAS

```
+---------------------------------------------------------------------+
|  1. LISTADO DE CONFIGURACION                                        |
|     GET /admin/configuracion                                        |
|     Template: admin/configuracion.html                              |
|  +---------------------------------------------------------------+  |
|  |  Nav lateral sticky: Categorias                                |  |
|  |  Stats box: Configuraciones modificadas                        |  |
|  |  Cards por categoria con parametros                            |  |
|  |  Forms inline para edicion (input/select + Guardar)            |  |
|  |  Badges: Modificado, Solo lectura, Requiere reinicio           |  |
|  +---------------------------------------------------------------+  |
|  [Recargar Cache]  [Restaurar Todo]                                 |
+---------------------------------------------------------------------+
                              |
                              | POST /admin/edit-configuracion
                              | POST /admin/reset-configuracion
                              | POST /admin/reset-all-configuracion
                              | POST /admin/refresh-cache
                              v
+---------------------------------------------------------------------+
|  REDIRECT /admin/configuracion                                      |
|  + Flash message (success/error)                                    |
+---------------------------------------------------------------------+
```

**Nota:** Este CU usa flujo de 1 paso con redirect after POST. No hay pantalla de confirmacion excepto para "Restaurar Todo" que usa confirm() de JavaScript.

---

## 4. ARCHIVOS INVOLUCRADOS

### Frontend (Templates)
| Archivo | Descripcion |
|---------|-------------|
| `templates/admin/configuracion.html` | Listado y formularios inline |

### Backend
| Archivo | Descripcion |
|---------|-------------|
| `controller/maestro/ConfiguracionController.java` | Controlador |
| `service/ConfiguracionService.java` | Servicio con cache y validacion |
| `entity/maestro/Configuracion.java` | Entidad JPA |
| `repository/maestro/ConfiguracionRepository.java` | Repositorio Spring Data |
| `config/ConfiguracionDataInitializer.java` | Inicializador de datos seed |
| `enums/TipoConfiguracion.java` | Enum de tipos de dato |

### Tests
| Archivo | Descripcion |
|---------|-------------|
| `service/ConfiguracionServiceTest.java` | Tests del servicio |

### Enums Relacionados
| Archivo | Responsabilidad |
|---------|-----------------|
| `enums/TipoConfiguracion.java` | STRING, INTEGER, LONG, BOOLEAN, ENUM, PASSWORD, PATH, EMAIL, URL |
| `enums/PermisosCasoUsoEnum.java` | Define CU42_CONFIGURACION_SISTEMA |

---

## 5. CAMPOS DEL FORMULARIO

### 5.1 Campos por Configuracion

Cada configuracion se muestra con un formulario inline que varia segun el tipo:

| Campo | HTML Element | Tipo | Condicion |
|-------|--------------|------|-----------|
| clave | input hidden | text | Siempre |
| valor (BOOLEAN) | select | dropdown | tipo == BOOLEAN |
| valor (ENUM) | select | dropdown | tipo == ENUM && opciones != null |
| valor (otros) | input | text | tipo != BOOLEAN && tipo != ENUM |
| _csrf | input hidden | text | Siempre |

### 5.2 Campos de la Entidad Configuracion

| Campo | Tipo Java | DB Column | Descripcion |
|-------|-----------|-----------|-------------|
| id | Long | BIGSERIAL PK | Identificador |
| clave | String(100) | VARCHAR UNIQUE | Clave unica (ej: security.login.max-attempts) |
| valor | String(500) | VARCHAR NOT NULL | Valor actual |
| valorDefault | String(500) | valor_default | Valor para restaurar |
| tipo | TipoConfiguracion | VARCHAR(20) | Tipo de dato |
| categoria | String(50) | VARCHAR NOT NULL | Agrupacion |
| descripcion | String(255) | VARCHAR | Descripcion legible |
| minValue | String(50) | min_value | Minimo para INTEGER/LONG |
| maxValue | String(50) | max_value | Maximo para INTEGER/LONG |
| opciones | String(500) | VARCHAR | Opciones para ENUM (separadas por coma) |
| editable | Boolean | BOOLEAN DEFAULT true | Si puede modificarse |
| requiereReinicio | Boolean | requiere_reinicio | Si requiere reiniciar app |
| activo | Boolean | BOOLEAN DEFAULT true | Soft delete flag |
| createdAt | OffsetDateTime | TIMESTAMPTZ | Fecha creacion |
| updatedAt | OffsetDateTime | TIMESTAMPTZ | Fecha modificacion |
| updatedBy | String(100) | VARCHAR | Usuario que modifico |

### 5.3 Informacion Mostrada por Configuracion

Cada item muestra:
- Badge con clave (monospace)
- Badge "Modificado" si valor != valorDefault
- Badge "Solo lectura" si editable = false
- Badge "Requiere reinicio" si requiereReinicio = true
- Descripcion en texto gris
- Tipo de dato
- Valores min/max si aplica
- Valor por defecto

---

## 6. VALIDACIONES POR CAPA

El sistema implementa validacion en 2 capas: Frontend (HTML5) y Validacion de Negocio (Service).

### 6.1 CAPA 1: FRONTEND (Browser - HTML5)

**Ubicacion:** `templates/admin/configuracion.html`

| Campo | Atributo HTML5 | Comportamiento |
|-------|---------------|----------------|
| valor (text) | - | Acepta cualquier valor |
| valor (select BOOLEAN) | - | Solo true/false |
| valor (select ENUM) | - | Solo opciones validas |

**JavaScript:**
- Smooth scroll a categorias
- Highlight categoria activa en scroll
- confirm() para "Restaurar Todo"

---

### 6.2 CAPA 2: VALIDACION DE NEGOCIO (Service Layer)

**Ubicacion:** `ConfiguracionService.java` (metodo `validarValor`)

El metodo ejecuta validaciones segun el tipo:

| Tipo | Validacion | Mensaje de Error |
|------|------------|------------------|
| null | valor == null | "El valor no puede ser nulo" |
| INTEGER | parseInt + min/max | "Se esperaba un numero entero" / "Valor minimo/maximo permitido: X" |
| LONG | parseLong + min/max | "Se esperaba un numero" / "Valor minimo/maximo permitido: X" |
| BOOLEAN | "true" o "false" (case insensitive) | "Se esperaba 'true' o 'false'" |
| ENUM | valor in opciones.split(",") | "Valor debe ser uno de: {opciones}" |
| EMAIL | regex ^[\w.-]+@[\w.-]+\.[a-zA-Z]{2,}$ | "Email invalido" |
| STRING/PATH/URL/PASSWORD | Sin validacion | - |

### 6.3 Validaciones Adicionales

| Condicion | Excepcion |
|-----------|-----------|
| Clave no existe | IllegalArgumentException: "Configuracion no encontrada: {clave}" |
| Config no editable | IllegalStateException: "La configuracion '{clave}' no es editable" |

---

## 7. TEMPLATE (Frontend)

### 7.1 Estilo Visual

El formulario utiliza la paleta de colores **admin** (rojo):

- **Header de pagina:** `page-header-admin` con gradiente rojo
- **Cards de categoria:** `.config-card` con `.config-card-header` gradiente admin
- **Badges:** `.badge-modified` (amarillo), `.badge-readonly` (gris), `.badge-restart` (rojo)
- **Nav lateral:** `.category-nav` sticky con links a categorias
- **Stats box:** `.stats-box` con gradiente admin

### 7.2 Librerias Utilizadas

| Libreria | Proposito |
|----------|-----------|
| Bootstrap 5.3 | Framework CSS base, grid responsivo |
| Bootstrap Icons 1.11 | Iconografia |
| common.css | Estilos compartidos del sistema |

### 7.3 Comportamiento JavaScript

1. **Smooth scroll:** Click en nav lateral scrollea suavemente a la categoria.

2. **Highlight activo:** Al hacer scroll, detecta categoria visible y marca link activo.

3. **Confirmacion reset all:** `confirm('Esta seguro que desea restaurar TODAS las configuraciones...')`.

4. **Reset individual:** Boton "Restaurar" ejecuta submit del form hidden `.reset-form`.

### 7.4 CSS Personalizado

```css
.config-card { background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.config-card-header { background: linear-gradient(135deg, var(--color-admin) 0%, var(--color-admin-dark) 100%); }
.config-key { font-family: monospace; background: var(--color-admin-bg); }
.config-value-form { display: flex; gap: 10px; align-items: center; }
.category-nav { position: sticky; top: 80px; }
.stats-box { background: linear-gradient(135deg, var(--color-admin-bg) 0%, var(--color-admin-border) 100%); }
```

---

## 8. CONTROLLER

### 8.1 Clase: ConfiguracionController

El controlador maneja el flujo de listado y operaciones CRUD sobre configuraciones.

### 8.2 Flujo de Endpoints

| Metodo | URL | Descripcion |
|--------|-----|-------------|
| GET | /admin/ | Redirect a /admin/configuracion |
| GET | /admin/configuracion | Muestra listado |
| POST | /admin/edit-configuracion | Actualiza valor |
| POST | /admin/reset-configuracion | Restaura una config |
| POST | /admin/reset-all-configuracion | Restaura todas |
| POST | /admin/refresh-cache | Recarga cache |

### 8.3 Modelo en GET /admin/configuracion

```java
@GetMapping("/configuracion")
public String listConfiguracion(Model model) {
    Map<String, List<Configuracion>> configsPorCategoria =
        configuracionService.findAllGroupedByCategoria();
    List<String> categorias = configuracionService.getCategorias();
    long modificadas = configuracionService.countModificadas();

    model.addAttribute("configsPorCategoria", configsPorCategoria);
    model.addAttribute("categorias", categorias);
    model.addAttribute("modificadas", modificadas);

    return "admin/configuracion";
}
```

### 8.4 Caracteristicas Destacadas

- **Inyeccion:** Constructor-based (ConfiguracionService)
- **Redirect after POST:** Evita reenvio de formulario
- **Flash Attributes:** Mensajes success/error via RedirectAttributes
- **Manejo de excepciones:** try-catch con flash attribute "error"

---

## 9. SERVICE

### 9.1 Clase: ConfiguracionService

El servicio contiene la logica de negocio y gestiona el cache en memoria.

### 9.2 Metodo Principal: updateValor

Este metodo actualiza el valor de una configuracion:

1. **Buscar config:** `configuracionRepository.findByClaveAndActivoTrue(clave)`. Si no existe, lanza `IllegalArgumentException`.

2. **Verificar editable:** Si `!config.getEditable()`, lanza `IllegalStateException`.

3. **Validar valor:** Llama a `validarValor(config, nuevoValor)` segun el tipo.

4. **Guardar valor anterior:** Para logging.

5. **Actualizar config:** `config.setValor(nuevoValor)`, `config.setUpdatedBy(getCurrentUsername())`.

6. **Persistir:** `configuracionRepository.save(config)`.

7. **Actualizar cache:** `cache.put(clave, nuevoValor)`.

8. **Logear:** `log.info("CONFIG_UPDATED | clave={} | valorAnterior={} | valorNuevo={} | usuario={}")`.

9. **Retornar:** Config actualizada.

### 9.3 Sistema de Cache

```java
private final Map<String, String> cache = new ConcurrentHashMap<>();
private volatile boolean cacheLoaded = false;

private void loadCacheIfNeeded() {
    if (!cacheLoaded) {
        synchronized (cache) {
            if (!cacheLoaded) {
                loadCache();  // Carga todas las configs activas
            }
        }
    }
}
```

El cache se carga lazy en el primer acceso y se actualiza automaticamente al modificar valores.

### 9.4 Getters Tipados (para otros servicios)

| Metodo | Clave | Default |
|--------|-------|---------|
| getMaxLoginAttempts() | security.login.max-attempts | 5 |
| getLoginBlockDurationMinutes() | security.login.block-duration-minutes | 15 |
| getSessionTimeoutMinutes() | security.session.timeout-minutes | 25 |
| getPasswordMinLength() | security.password.min-length | 8 |
| getPasswordExpirationDays() | security.password.expiration-days | 180 |
| isPasswordUppercaseRequired() | security.password.require-uppercase | true |
| isPasswordLowercaseRequired() | security.password.require-lowercase | true |
| isPasswordDigitRequired() | security.password.require-digit | true |
| isPasswordSpecialCharRequired() | security.password.require-special-char | true |
| getAlertDaysBeforeExpiry() | lotes.alert-days-before-expiry | 60 |
| getAlertDaysBeforeReanalysis() | lotes.alert-days-before-reanalysis | 30 |
| getRecordsPerPage() | ui.records-per-page | 25 |
| getDateFormat() | ui.date-format | dd/MM/yyyy |
| getTimezone() | ui.timezone | America/Argentina/Buenos_Aires |

### 9.5 Metodo: resetToDefault

Restaura una configuracion a su valor por defecto:

1. Busca config por clave
2. Verifica editable
3. Llama `config.resetToDefault()` (copia valorDefault a valor)
4. Actualiza updatedBy
5. Persiste
6. Actualiza cache
7. Logea: `CONFIG_RESET | clave={} | valorAnterior={} | valorDefault={} | usuario={}`

### 9.6 Metodo: resetAllToDefaults

Restaura todas las configuraciones editables y modificadas:

```java
all.forEach(config -> {
    if (config.getEditable() && config.isModificado()) {
        config.resetToDefault();
        config.setUpdatedBy(usuario);
    }
});
configuracionRepository.saveAll(all);
invalidateCache();
```

---

## 10. PERSISTENCIA

### 10.1 Entidad Afectada

| Entidad | Accion | Descripcion |
|---------|--------|-------------|
| Configuracion | UPDATE | Modifica valor, updatedBy, updatedAt |

**Nota:** No se crean ni eliminan configuraciones desde la UI. Los datos seed se crean via `ConfiguracionDataInitializer` al arranque si la tabla esta vacia.

### 10.2 Queries del Repository

```java
// Buscar por clave activa
Optional<Configuracion> findByClaveAndActivoTrue(String clave);

// Listar todas activas ordenadas
List<Configuracion> findByActivoTrueOrderByCategoriaAscClaveAsc();

// Obtener categorias distintas
@Query("SELECT DISTINCT c.categoria FROM Configuracion c WHERE c.activo = true ORDER BY c.categoria")
List<String> findDistinctCategorias();

// Buscar modificadas (valor != valorDefault)
@Query("SELECT c FROM Configuracion c WHERE c.activo = true AND c.valor <> c.valorDefault ORDER BY c.categoria, c.clave")
List<Configuracion> findModificadas();
```

### 10.3 Tabla en Base de Datos

```sql
CREATE TABLE IF NOT EXISTS configuracion
(
    id                BIGSERIAL PRIMARY KEY,
    clave             VARCHAR(100) NOT NULL UNIQUE,
    valor             VARCHAR(500) NOT NULL,
    valor_default     VARCHAR(500) NOT NULL,
    tipo              VARCHAR(20)  NOT NULL,
    categoria         VARCHAR(50)  NOT NULL,
    descripcion       VARCHAR(255),
    min_value         VARCHAR(50),
    max_value         VARCHAR(50),
    opciones          VARCHAR(500),
    editable          BOOLEAN      NOT NULL DEFAULT true,
    requiere_reinicio BOOLEAN      NOT NULL DEFAULT false,
    activo            BOOLEAN      NOT NULL DEFAULT true,
    created_at        TIMESTAMPTZ  NOT NULL DEFAULT NOW(),
    updated_at        TIMESTAMPTZ,
    updated_by        VARCHAR(100)
);

CREATE INDEX IF NOT EXISTS idx_configuracion_categoria ON configuracion (categoria);
CREATE INDEX IF NOT EXISTS idx_configuracion_clave ON configuracion (clave);
```

### 10.4 Datos Seed (ConfiguracionDataInitializer)

Al arranque, si `configuracionRepository.count() == 0`, se insertan ~34 configuraciones por defecto en categorias: security (11), lotes (5), audit (5), backup (5), ui (8).

---

## 11. AUDITORIA (ANMAT)

El sistema cumple con los requerimientos de la Disposicion ANMAT 4159:

- **Hibernate Envers:** La entidad Configuracion tiene `@Audited`. Cada cambio genera registro en `configuracion_aud`.

```java
@Entity
@Audited
@Table(name = "configuracion", ...)
public class Configuracion { ... }
```

- **Tabla de auditoria:**

```sql
CREATE TABLE IF NOT EXISTS configuracion_aud
(
    id                BIGINT  NOT NULL,
    rev               INTEGER NOT NULL,
    revtype           SMALLINT,
    clave             VARCHAR(100),
    valor             VARCHAR(500),
    valor_default     VARCHAR(500),
    tipo              VARCHAR(20),
    categoria         VARCHAR(50),
    descripcion       VARCHAR(255),
    ...
    updated_by        VARCHAR(100),
    PRIMARY KEY (id, rev)
);
```

- **Campo updatedBy:** Se registra automaticamente el usuario que realiza el cambio.

- **Logging estructurado:** Cada cambio genera log con formato `CONFIG_UPDATED | clave={} | valorAnterior={} | valorNuevo={} | usuario={}`.

---

## 12. SEGURIDAD

- **CSRF:** Token incluido como campo oculto en cada formulario:
  ```html
  <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden"/>
  ```

- **Autorizacion:** Solo ADMIN puede acceder (configurado via `PermisosCasoUsoEnum` -> `SecurityConfig`).

- **XSS:** Datos renderizados con escape automatico (`th:text`). No hay `th:utext` en el template.

- **Confirmacion de acciones criticas:** "Restaurar Todo" requiere confirm() de JavaScript.

- **Validacion de editabilidad:** El service verifica `config.getEditable()` antes de permitir cambios.

---

## 13. MANEJO DE ERRORES

Los errores se manejan en diferentes niveles:

### Controller
```java
try {
    configuracionService.updateValor(clave, valor);
    redirectAttributes.addFlashAttribute("success", "Configuracion '" + clave + "' actualizada correctamente");
} catch (IllegalArgumentException | IllegalStateException e) {
    redirectAttributes.addFlashAttribute("error", e.getMessage());
}
```

### Service
| Error | Excepcion | Mensaje |
|-------|-----------|---------|
| Clave no existe | IllegalArgumentException | "Configuracion no encontrada: {clave}" |
| No editable | IllegalStateException | "La configuracion '{clave}' no es editable" |
| Valor nulo | IllegalArgumentException | "El valor no puede ser nulo" |
| INTEGER inválido | IllegalArgumentException | "Se esperaba un número entero" |
| Fuera de rango | IllegalArgumentException | "Valor mínimo/máximo permitido: X" |
| BOOLEAN inválido | IllegalArgumentException | "Se esperaba 'true' o 'false'" |
| ENUM inválido | IllegalArgumentException | "Valor debe ser uno de: {opciones}" |
| EMAIL inválido | IllegalArgumentException | "Email inválido" |

### Template
```html
<div class="alert alert-danger" th:if="${error}">
    <i class="bi bi-exclamation-triangle-fill"></i> <span th:text="${error}"></span>
</div>
<div class="alert alert-success" th:if="${success}">
    <i class="bi bi-check-circle-fill"></i> <span th:text="${success}"></span>
</div>
```

---

## 14. LOGGING

El service registra eventos en los siguientes puntos:

| Evento | Nivel | Formato |
|--------|-------|---------|
| Actualizacion | INFO | `CONFIG_UPDATED \| clave={} \| valorAnterior={} \| valorNuevo={} \| usuario={}` |
| Reset individual | INFO | `CONFIG_RESET \| clave={} \| valorAnterior={} \| valorDefault={} \| usuario={}` |
| Reset masivo | INFO | `CONFIG_RESET \| clave={} \| valorAnterior={} \| valorDefault={} \| usuario={}` (por cada config) |
| Error de parseo | WARN | `Error parseando configuracion '{}' como Integer/Long: {}` |
| Cache cargado | DEBUG | `Cache de configuracion cargado con {} entradas` |
| Cache invalidado | DEBUG | `Cache de configuracion invalidado` |
| Error cargando cache | WARN | `Error cargando cache de configuracion: {}. Se usaran valores por defecto.` |

Logger: `@Slf4j` de Lombok

---

## 15. MEJORAS SUGERIDAS

| Prioridad | Mejora |
|-----------|--------|
| ALTA | Implementar validacion para tipos URL y PATH |
| MEDIA | Agregar campo de busqueda para filtrar configs por clave/descripcion |
| MEDIA | Permitir exportar/importar configuracion como JSON |
| BAJA | Mostrar historial de cambios desde Envers en la UI |
| BAJA | Comparar config actual vs default visualmente (diff) |
| BAJA | Notificaciones destacadas para configs que requieren reinicio |

---

## 16. APENDICE: CONFIGURACIONES DISPONIBLES

### A.1 Categoria: security

| Clave | Tipo | Default | Min | Max | Reinicio |
|-------|------|---------|-----|-----|----------|
| security.login.max-attempts | INTEGER | 5 | 3 | 10 | No |
| security.login.block-duration-minutes | INTEGER | 15 | 5 | 60 | No |
| security.session.timeout-minutes | INTEGER | 25 | 10 | 60 | Si |
| security.password.min-length | INTEGER | 8 | 8 | 16 | No |
| security.password.expiration-days | INTEGER | 180 | 0 | 365 | No |
| security.password.history-count | INTEGER | 5 | 0 | 12 | No |
| security.password.require-uppercase | BOOLEAN | true | - | - | No |
| security.password.require-lowercase | BOOLEAN | true | - | - | No |
| security.password.require-digit | BOOLEAN | true | - | - | No |
| security.password.require-special-char | BOOLEAN | true | - | - | No |
| security.password.special-characters | STRING | !@#$%^&*()... | - | - | No |

### A.2 Categoria: lotes

| Clave | Tipo | Default | Min | Max | Reinicio |
|-------|------|---------|-----|-----|----------|
| lotes.alert-days-before-expiry | INTEGER | 60 | 30 | 180 | No |
| lotes.alert-days-before-reanalysis | INTEGER | 30 | 15 | 90 | No |
| lotes.max-genealogy-depth | INTEGER | 100 | 50 | 200 | No |
| lotes.quantity-decimal-precision | INTEGER | 4 | 2 | 6 | Si |
| lotes.default-unit | ENUM | KILOGRAMO | - | - | No |

### A.3 Categoria: audit

| Clave | Tipo | Default | Min | Max | Reinicio |
|-------|------|---------|-----|-----|----------|
| audit.retention-years | INTEGER | 7 | 5 | 10 | No |
| audit.log-retention-days | INTEGER | 90 | 30 | 365 | No |
| audit.log-level | ENUM | WARN | - | - | Si |
| audit.log-sql-queries | BOOLEAN | false | - | - | Si |
| audit.log-read-operations | BOOLEAN | false | - | - | No |

### A.4 Categoria: backup

| Clave | Tipo | Default | Min | Max | Reinicio |
|-------|------|---------|-----|-----|----------|
| backup.frequency-hours | INTEGER | 1 | 1 | 24 | No |
| backup.retention-days | INTEGER | 30 | 7 | 90 | No |
| backup.path | PATH | /backups | - | - | Si |
| backup.before-critical-operations | BOOLEAN | true | - | - | No |
| backup.compression-enabled | BOOLEAN | true | - | - | No |

### A.5 Categoria: ui

| Clave | Tipo | Default | Min | Max | Reinicio |
|-------|------|---------|-----|-----|----------|
| ui.records-per-page | INTEGER | 25 | 10 | 100 | No |
| ui.date-format | STRING | dd/MM/yyyy | - | - | No |
| ui.datetime-format | STRING | dd/MM/yyyy HH:mm | - | - | No |
| ui.timezone | STRING | America/Argentina/Buenos_Aires | - | - | Si |
| ui.language | ENUM | es | - | - | Si |
| ui.theme | ENUM | light | - | - | No |
| ui.company-name | STRING | Conifarma | - | - | No |
| ui.custom-logo-path | PATH | (vacio) | - | - | No |

---

*Documento generado: 2025-12-14*
*Version: 1.0*
