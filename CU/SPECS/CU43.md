# CU43 - ABM USUARIOS

**Caso de Uso:** ABM de Usuarios del Sistema
**URL Base:** `/users`
**Tipo:** ABM (Alta/Baja/Modificacion)
**Categoria:** Administracion (color gris/slate)
**Identificador Interno:** `CU43_ABM_USUARIOS`

---

## 1. DESCRIPCION

Permite gestionar los usuarios del sistema: crear nuevos usuarios, modificar datos existentes, eliminar usuarios, desbloquear cuentas bloqueadas y forzar cambio de contrasena. Es el unico CU que realiza eliminacion fisica (no soft delete) debido a que la auditoria de usuarios se mantiene via logs y Hibernate Envers.

**Caracteristicas principales:**
- Solo accesible por rol ADMIN
- Eliminacion FISICA de usuarios (no soft delete)
- Validacion de contrasenas configurable via CU42
- Gestion de bloqueo/desbloqueo de cuentas
- Forzado de cambio de contrasena
- Auditoria completa via Hibernate Envers y logs estructurados
- Cumple ANMAT Disp. 4159 Anexo 6 Req. 12.3

**Operaciones disponibles:**
| Operacion | URL | Metodo |
|-----------|-----|--------|
| Listar usuarios | `/users/list-users` | GET |
| Agregar usuario | `/users/add-user` | GET/POST |
| Editar usuario | `/users/edit-user/{id}` | GET/POST |
| Eliminar usuario | `/users/delete-user` | POST |
| Desbloquear cuenta | `/users/unlock-user` | POST |
| Forzar cambio password | `/users/force-password-change` | POST |

---

## 2. ROLES AUTORIZADOS

| Rol | Nivel | Acceso |
|-----|-------|--------|
| ADMIN | 6 | Permitido |
| Otros | - | No permitido |

**Configuracion en SecurityConfig:**
```java
auth.requestMatchers("/users/**").hasRole("ADMIN");
```

**Referencia:** `PermisosCasoUsoEnum.CU43_ABM_USUARIOS`

**Excepcion:** La URL `/users/change-password` esta disponible para todos los usuarios autenticados (cambio de password propio).

---

## 3. FLUJO DE PANTALLAS

### 3.1 Flujo Alta de Usuario

```
+---------------------------------------------------------------------+
|  1. LISTADO                                                          |
|     GET /users/list-users                                            |
|     Template: users/list-users.html                                  |
|  +---------------------------------------------------------------+  |
|  |  DataTable con usuarios del sistema                           |  |
|  |  Columnas: ID, Usuario, Rol, Nivel, Fecha Exp, Estado         |  |
|  |  Acciones: Editar, Desbloquear, Forzar Pass, Eliminar         |  |
|  +---------------------------------------------------------------+  |
|  [Agregar Usuario] ->                                                |
+---------------------------------------------------------------------+
                              |
                              | GET /users/add-user
                              v
+---------------------------------------------------------------------+
|  2. FORMULARIO ALTA                                                  |
|     GET /users/add-user                                              |
|     Template: users/add-user.html                                    |
|  +---------------------------------------------------------------+  |
|  |  Username (obligatorio, 3-50 chars)                           |  |
|  |  Password (obligatorio, segun politica)                       |  |
|  |  Rol (selector obligatorio)                                   |  |
|  |  Fecha Expiracion (opcional)                                  |  |
|  +---------------------------------------------------------------+  |
|  [Cancelar]                                  [Guardar Usuario] ->    |
+---------------------------------------------------------------------+
                              |
                              | POST /users/add-user
                              v
+---------------------------------------------------------------------+
|  3. REDIRECCION A LISTADO                                            |
|     redirect:/users/list-users                                       |
|     Flash: "success" message                                         |
+---------------------------------------------------------------------+
```

### 3.2 Flujo Edicion de Usuario

```
+---------------------------------------------------------------------+
|  1. LISTADO -> Clic en Editar                                        |
+---------------------------------------------------------------------+
                              |
                              | GET /users/edit-user/{id}
                              v
+---------------------------------------------------------------------+
|  2. FORMULARIO EDICION                                               |
|     GET /users/edit-user/{id}                                        |
|     Template: users/edit-user.html                                   |
|  +---------------------------------------------------------------+  |
|  |  Info actual: ID, Username, Rol, Estado                       |  |
|  |  Username (readonly, no editable)                             |  |
|  |  Nueva Password (opcional, vacio = no cambiar)                |  |
|  |  Rol (selector obligatorio)                                   |  |
|  |  Fecha Expiracion (opcional)                                  |  |
|  +---------------------------------------------------------------+  |
|  [Cancelar]                                  [Guardar Cambios] ->    |
+---------------------------------------------------------------------+
                              |
                              | POST /users/edit-user/{id}
                              v
+---------------------------------------------------------------------+
|  3. REDIRECCION A LISTADO                                            |
|     redirect:/users/list-users                                       |
|     Flash: "User updated successfully!"                              |
+---------------------------------------------------------------------+
```

---

## 4. ARCHIVOS INVOLUCRADOS

### Frontend (Templates)
| Archivo | Descripcion |
|---------|-------------|
| `templates/users/list-users.html` | Listado con DataTable |
| `templates/users/add-user.html` | Formulario alta |
| `templates/users/edit-user.html` | Formulario edicion |

### Backend
| Archivo | Descripcion |
|---------|-------------|
| `controller/maestro/ABMUsersController.java` | Controlador ABM |
| `service/PasswordValidator.java` | Validador de contrasenas |
| `service/SecurityContextService.java` | Obtener usuario actual |

### Entidades
| Archivo | Descripcion |
|---------|-------------|
| `entity/maestro/User.java` | Entidad Usuario |
| `entity/maestro/Role.java` | Entidad Rol |

### Repositorios
| Archivo | Descripcion |
|---------|-------------|
| `repository/maestro/UserRepository.java` | CRUD de usuarios |
| `repository/maestro/RoleRepository.java` | CRUD de roles |

### Tests
| Archivo | Descripcion |
|---------|-------------|
| `controller/ABMUsersControllerTest.java` | Tests del controlador |

### Enums Relacionados
| Archivo | Uso |
|---------|-----|
| `enums/PermisosCasoUsoEnum.java` | Define CU43_ABM_USUARIOS con roles |
| `enums/RoleEnum.java` | Define los 8 roles del sistema |

---

## 5. CAMPOS DEL FORMULARIO

### 5.1 Alta de Usuario (add-user.html)

| Campo | HTML ID | Tipo | Validacion Browser | Validacion Server |
|-------|---------|------|-------------------|-------------------|
| Username | `username` | text | `required`, `minlength="3"`, `maxlength="50"` | `@NotNull`, `@Size(min=3, max=50)`, unicidad |
| Password | `password` | password | `required`, `minlength="3"` | PasswordValidator (politica configurable) |
| Rol | `role` | select | `required` | Existencia en BD |
| Fecha Expiracion | `fechaExpiracion` | date | - | Formato valido si presente |

### 5.2 Edicion de Usuario (edit-user.html)

| Campo | HTML ID | Tipo | Validacion Browser | Validacion Server |
|-------|---------|------|-------------------|-------------------|
| Username | `username` | text | `readonly`, `disabled` | No editable |
| Nueva Password | `password` | password | `minlength="3"` | PasswordValidator si no vacio |
| Rol | `role` | select | `required` | Existencia en BD |
| Fecha Expiracion | `fechaExpiracion` | date | - | Formato valido si presente |

### 5.3 Campos Hidden

| Campo | Valor |
|-------|-------|
| `_csrf` | Token CSRF |
| `id` | ID del usuario (en edicion y acciones POST) |

### 5.4 Campos Automaticos (Alta)

| Campo | Valor Inicial |
|-------|---------------|
| mustChangePassword | `true` |
| passwordChangedAt | `null` |
| failedLoginAttempts | `0` |
| accountLocked | `false` |
| lockTime | `null` |

---

## 6. VALIDACIONES POR CAPA

### 6.1 CAPA 1: FRONTEND (Browser - HTML5)

**Ubicacion:** `templates/users/add-user.html`, `templates/users/edit-user.html`

| Campo | Atributo HTML5 | Comportamiento |
|-------|---------------|----------------|
| `username` | `required`, `minlength="3"`, `maxlength="50"` | Bloquea submit si invalido |
| `password` | `required` (alta), `minlength="3"` | Bloquea submit si vacio (alta) |
| `role` | `required` | Bloquea submit si no seleccionado |

### 6.2 CAPA 2: BEAN VALIDATION (Spring - Anotaciones Jakarta)

**Ubicacion:** `entity/maestro/User.java`

| Campo | Anotaciones | Mensaje de Error |
|-------|-------------|------------------|
| username | `@NotNull`, `@Size(min=3, max=50)` | "Username is required" / "Username must be between 3 and 50 characters" |
| password | `@NotNull`, `@Size(min=8)` | "Password is required" / "Password must be at least 8 characters" |

### 6.3 CAPA 3: VALIDACION DE NEGOCIO (Controller Layer)

**Ubicacion:** `ABMUsersController.java`

El controlador ejecuta validaciones adicionales en los metodos POST:

#### addUser (lineas 80-133)

| # | Validacion | Codigo | Mensaje |
|---|-----------|--------|---------|
| 1 | BindingResult | `result.hasErrors()` | "Validacion fallida!" |
| 2 | Username unico | `userRepository.findByUsername()` | "El usuario ya existe!" |
| 3 | Password valido | `passwordValidator.getValidationErrors()` | Mensajes dinamicos de politica |
| 4 | Rol presente | `user.getRole() == null` | "El rol es requerido!" |
| 5 | Rol existe | `roleRepository.findById()` | "Rol no encontrado!" |

#### editUser (lineas 151-205)

| # | Validacion | Codigo | Mensaje |
|---|-----------|--------|---------|
| 1 | Usuario existe | `userRepository.findById()` | "Usuario no encontrado!" |
| 2 | Rol existe | `roleRepository.findByName()` | "Rol no encontrado!" |
| 3 | Password valido (si presente) | `passwordValidator.getValidationErrors()` | Mensajes dinamicos |
| 4 | Fecha formato valido | `LocalDate.parse()` | "Formato de fecha de expiracion invalido!" |

### 6.4 Politica de Contrasenas (PasswordValidator)

La politica es configurable via CU42 (ConfiguracionService):

| Requisito | Clave Configuracion | Default |
|-----------|---------------------|---------|
| Longitud minima | `security.password.min-length` | 8 |
| Requiere mayuscula | `security.password.require-uppercase` | true |
| Requiere minuscula | `security.password.require-lowercase` | true |
| Requiere digito | `security.password.require-digit` | true |
| Requiere especial | `security.password.require-special-char` | true |
| Caracteres especiales | `security.password.special-characters` | `!@#$%^&*()_+-=[]{}|;:,.<>?` |

---

## 7. TEMPLATE (Frontend)

### 7.1 Estilo Visual

Los formularios utilizan la paleta de colores **ABM** (gris/slate):

- **Fondo de pagina:** `bg-abm`
- **Tarjeta del formulario:** `form-abm` con borde gris
- **Botones primarios:** `btn-abm`
- **Section titles:** `section-title-abm`
- **Badge:** "ABM" con fondo gris (var(--color-abm))

### 7.2 Librerias Utilizadas

| Libreria | Proposito |
|----------|-----------|
| Bootstrap 5.3 | Framework CSS base, grid responsivo |
| Bootstrap Icons 1.11 | Iconografia |
| jQuery 3.7 | Manipulacion DOM (listado) |
| DataTables 1.13.8 | Tabla interactiva con filtros |
| DataTables Buttons | Exportacion a Excel |
| common.css | Estilos compartidos del sistema |

### 7.3 Comportamiento JavaScript (list-users.html)

1. **DataTable:** Inicializa tabla con paginacion, filtros por columna, ordenamiento.
2. **Exportacion Excel:** Boton para exportar listado (excluye columna acciones).
3. **Lenguaje:** Configurado en espanol via CDN.
4. **Filtros por columna:** Inputs en header para filtrar cada columna.

### 7.4 Estados Visuales en Listado

| Estado | Badge | Condicion |
|--------|-------|-----------|
| Expirado | `bg-danger` | `fechaExpiracion < today` |
| Bloqueado | `bg-warning` | `accountLocked = true` |
| Cambiar Pass | `bg-info` | `mustChangePassword = true` |
| Activo | `bg-success` | Ninguna de las anteriores |

### 7.5 Acciones Condicionales

| Accion | Condicion para mostrar |
|--------|------------------------|
| Desbloquear | `user.accountLocked = true` |
| Forzar cambio password | `user.mustChangePassword = false` |
| Editar | Siempre visible |
| Eliminar | Siempre visible |

---

## 8. CONTROLLER

### 8.1 Clase: ABMUsersController

El controlador maneja todas las operaciones CRUD de usuarios. No extiende ninguna clase base especifica.

### 8.2 Dependencias Inyectadas

| Dependencia | Uso |
|-------------|-----|
| UserRepository | CRUD de usuarios |
| RoleRepository | Busqueda de roles |
| PasswordEncoder | Hasheo BCrypt |
| PasswordValidator | Validacion de politica |
| SecurityContextService | Obtener admin actual para logs |

### 8.3 Endpoints

| Metodo | URL | Descripcion |
|--------|-----|-------------|
| GET | `/users/` | Redirige a list-users |
| GET | `/users/list-users` | Listado de usuarios |
| GET | `/users/add-user` | Formulario alta |
| POST | `/users/add-user` | Procesa alta |
| GET | `/users/edit-user/{id}` | Formulario edicion |
| POST | `/users/edit-user/{id}` | Procesa edicion |
| POST | `/users/delete-user` | Elimina usuario |
| POST | `/users/unlock-user` | Desbloquea cuenta |
| POST | `/users/force-password-change` | Fuerza cambio password |

### 8.4 Modelo en GET

#### list-users
- `users`: Lista de todos los usuarios (`userRepository.findAll()`)

#### add-user
- `user`: Nuevo objeto User vacio
- `roles`: Lista de roles disponibles
- `passwordPolicy`: Descripcion de politica de password

#### edit-user/{id}
- `user`: Usuario a editar
- `roles`: Lista de roles disponibles
- `passwordPolicy`: Descripcion de politica de password

### 8.5 Flujo de addUser (POST)

```
1. Verificar BindingResult -> si errores, retornar formulario
2. Verificar username unico -> si existe, retornar error
3. Validar password contra politica -> si invalido, retornar errores
4. Verificar rol presente y valido -> si no, retornar error
5. Hashear password con BCrypt
6. Guardar usuario (mustChangePassword=true por defecto)
7. Log: USER_CREATED
8. Redirect a listado
```

### 8.6 Flujo de editUser (POST)

```
1. Buscar usuario por ID -> si no existe, redirect con error
2. Buscar rol por nombre -> si no existe, redirect con error
3. Si password presente:
   a. Validar contra politica -> si invalido, redirect con error
   b. Hashear y actualizar password
4. Actualizar rol
5. Parsear y actualizar fecha expiracion (o null si vacia)
6. Guardar usuario
7. Log: USER_MODIFIED
8. Redirect a listado con success
```

---

## 9. SERVICE

### 9.1 Nota sobre Arquitectura

A diferencia de otros CUs que tienen un Service dedicado, CU43 implementa la logica directamente en el Controller. Esto es aceptable para operaciones ABM simples sin logica de negocio compleja.

### 9.2 PasswordValidator

El servicio `PasswordValidator` encapsula la validacion de contrasenas:

**Metodos principales:**

| Metodo | Descripcion |
|--------|-------------|
| `isValid(password)` | Retorna true si cumple politica |
| `getValidationErrors(password)` | Lista de mensajes de error |
| `getPolicyDescription()` | Descripcion legible de politica |

**Flujo de validacion:**

```
1. Verificar password no nulo/vacio
2. Verificar longitud >= minLength
3. Si requireUppercase: verificar mayuscula
4. Si requireLowercase: verificar minuscula
5. Si requireDigit: verificar numero
6. Si requireSpecialChar: verificar caracter especial
7. Retornar lista de errores (vacia si valido)
```

### 9.3 Metodos de User (entidad)

La entidad User contiene metodos de negocio:

| Metodo | Descripcion |
|--------|-------------|
| `isExpired()` | True si fechaExpiracion < hoy |
| `isAuditor()` | True si rol = AUDITOR |
| `isAdmin()` | True si rol = ADMIN |
| `isPasswordExpired(days)` | True si password vencido |
| `isAccountLockedAndActive(minutes)` | True si bloqueado y no vencido |
| `registerFailedLogin(maxAttempts)` | Incrementa contador, bloquea si excede |
| `resetLoginAttempts()` | Resetea contadores tras login exitoso |
| `unlockAccount()` | Desbloquea manualmente |
| `recordPasswordChange()` | Registra cambio de password |

---

## 10. PERSISTENCIA

### 10.1 Entidades Afectadas

| Entidad | Operacion | Notas |
|---------|-----------|-------|
| User | INSERT/UPDATE/DELETE | Eliminacion FISICA |
| Role | READ | Solo lectura |

### 10.2 Campos de User

| Campo | Tipo | Descripcion |
|-------|------|-------------|
| id | Long | PK auto-generada |
| username | String | Unico, 3-50 chars |
| password | String | Hash BCrypt, @NotAudited |
| role | Role | FK a roles |
| fechaExpiracion | LocalDate | Nullable |
| passwordChangedAt | LocalDateTime | Ultimo cambio password |
| mustChangePassword | boolean | Default true |
| failedLoginAttempts | int | Default 0 |
| lastFailedLogin | LocalDateTime | Nullable |
| accountLocked | boolean | Default false |
| lockTime | LocalDateTime | Nullable |

### 10.3 Eliminacion Fisica

A diferencia de otras entidades que usan soft delete (`activo=false`), los usuarios se eliminan fisicamente:

```java
userRepository.deleteById(id);
```

**Justificacion:** La trazabilidad se mantiene via:
- Logs estructurados (USER_DELETED)
- Hibernate Envers (tablas _aud)
- Movimientos mantienen referencia historica al username

### 10.4 Cascade y Relaciones

| Relacion | Tipo | Cascade |
|----------|------|---------|
| User -> Role | ManyToOne | Ninguno |
| Role -> Users | OneToMany | CascadeType.ALL |

---

## 11. AUDITORIA (ANMAT)

El sistema cumple con los requerimientos de la Disposicion ANMAT 4159:

### 11.1 Hibernate Envers

Ambas entidades estan auditadas:

```java
@Entity
@Audited
public class User { ... }

@Entity
@Audited
public class Role { ... }
```

**Excepcion:** El campo `password` tiene `@NotAudited` por seguridad (no se auditan hashes).

### 11.2 Logging Estructurado

Cada operacion genera un log con formato consistente:

| Operacion | Formato Log |
|-----------|-------------|
| Alta | `USER_CREATED \| admin={} \| new_user={} \| role={} \| fecha_expiracion={}` |
| Modificacion | `USER_MODIFIED \| admin={} \| user={}` |
| Eliminacion | `USER_DELETED \| admin={} \| deleted_user={} \| role={}` |
| Desbloqueo | `USER_UNLOCKED \| admin={} \| user={}` |
| Forzar pass | `USER_FORCE_PASSWORD_CHANGE \| admin={} \| user={}` |

### 11.3 Requisito ANMAT 12.3

El ABM de usuarios cumple con el registro de altas, bajas y modificaciones de usuarios del sistema.

---

## 12. SEGURIDAD

### 12.1 CSRF

Token incluido como campo oculto en todos los formularios:

```html
<input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden"/>
```

### 12.2 Autorizacion

- **URL Pattern:** `/users/**` requiere rol ADMIN
- **Excepcion:** `/users/change-password` accesible para todos los autenticados
- **Configuracion:** `SecurityConfig.java` lineas 68-70

### 12.3 Password Security

- Hash BCrypt antes de guardar: `passwordEncoder.encode(password)`
- Campo `password` excluido de auditoria Envers
- Politica de contrasenas configurable
- Forzado de cambio en primer login

### 12.4 XSS

- Datos renderizados con escape automatico (`th:text`)
- No se usa `th:utext` con datos de usuario

### 12.5 Confirmacion de Acciones Destructivas

Eliminacion y desbloqueo requieren confirmacion JavaScript:

```javascript
onsubmit="return confirm('Esta seguro que desea eliminar este usuario?');"
```

---

## 13. MANEJO DE ERRORES

### 13.1 Errores de Validacion (Controller)

| Situacion | Mensaje | Accion |
|-----------|---------|--------|
| BindingResult con errores | "Validacion fallida!" | Retorna formulario |
| Username duplicado | "El usuario ya existe!" | Retorna formulario |
| Password invalido | Mensajes de PasswordValidator | Retorna formulario |
| Rol no seleccionado | "El rol es requerido!" | Retorna formulario |
| Rol no encontrado | "Rol no encontrado!" | Retorna formulario / Redirect |
| Usuario no encontrado | "Usuario no encontrado!" | Redirect con error |
| Fecha formato invalido | "Formato de fecha de expiracion invalido!" | Redirect con error |

### 13.2 Visualizacion de Errores (Template)

```html
<div class="alert alert-danger" th:if="${error}">
    <i class="bi bi-exclamation-triangle-fill"></i>
    <strong>Error:</strong> <span th:text="${error}"></span>
</div>
```

### 13.3 Mensajes de Exito

Flash attributes para mensajes entre redirects:

```java
redirectAttributes.addFlashAttribute("success", "Usuario actualizado exitosamente!");
```

---

## 14. LOGGING

### 14.1 Puntos de Log

| Evento | Nivel | Mensaje |
|--------|-------|---------|
| Usuario creado | INFO | `USER_CREATED \| admin={} \| new_user={} \| role={} \| fecha_expiracion={}` |
| Usuario modificado | INFO | `USER_MODIFIED \| admin={} \| user={}` |
| Usuario eliminado | INFO | `USER_DELETED \| admin={} \| deleted_user={} \| role={}` |
| Usuario desbloqueado | INFO | `USER_UNLOCKED \| admin={} \| user={}` |
| Forzar cambio password | INFO | `USER_FORCE_PASSWORD_CHANGE \| admin={} \| user={}` |

### 14.2 Formato de Log

Todos los logs incluyen:
- Tipo de evento (USER_*)
- Usuario admin que ejecuta la accion
- Usuario afectado
- Datos relevantes (rol, fecha expiracion, etc.)

### 14.3 Configuracion Logback

Los logs de ABM de usuarios van a:
- `conitrack-app.log` (90 dias retencion)
- `conitrack-audit.log` (365 dias retencion)

---

## 15. MEJORAS SUGERIDAS

| Prioridad | Mejora |
|-----------|--------|
| ALTA | Agregar `@PreAuthorize` explicito en cada endpoint del controller |
| MEDIA | Implementar soft delete en lugar de eliminacion fisica |
| MEDIA | Agregar confirmacion de password en formulario de alta |
| MEDIA | Agregar log de cambios especificos en editUser (que campos cambiaron) |
| BAJA | Agregar paginacion server-side para sistemas con muchos usuarios |
| BAJA | Agregar busqueda AJAX en selector de roles si hay muchos |

---

## 16. TESTS

### 16.1 Cobertura de Tests

El archivo `ABMUsersControllerTest.java` (676 lineas) cubre:

| Test | Descripcion |
|------|-------------|
| `addUser_Success` | Alta exitosa |
| `addUser_UserAlreadyExists` | Username duplicado |
| `addUser_nullRole` | Rol nulo |
| `addUser_nullRoleId` | Rol sin ID |
| `addUser_resultWithErrors` | BindingResult con errores |
| `addUser_roleNotFound` | Rol no existe |
| `addUser_PasswordValidationFails` | Password no cumple politica |
| `deleteUser_UserExists` | Eliminacion exitosa |
| `deleteUser_UserNotFound` | Usuario no existe |
| `editUser_UserExists` | Edicion exitosa |
| `editUser_UserNotFound` | Usuario no existe |
| `editUser_RoleNotFound` | Rol no existe |
| `editUser_NoPasswordProvided` | Edicion sin cambio de password |
| `editUser_EmptyPasswordProvided` | Password vacio |
| `editUser_WithValidFechaExpiracion` | Fecha expiracion valida |
| `editUser_WithInvalidFechaExpiracion` | Fecha formato invalido |
| `editUser_WithEmptyFechaExpiracion` | Limpiar fecha expiracion |
| `editUser_PasswordValidationFails` | Password invalido en edicion |
| `listUsers` | Listado de usuarios |
| `showAddUserForm` | Mostrar formulario alta |
| `showEditUserForm_UserExists` | Mostrar formulario edicion |
| `showEditUserForm_UserNotFound` | Usuario no existe |
| `usersPage` | Redirect de / a list-users |
| `unlockUser_Success` | Desbloqueo exitoso |
| `unlockUser_UserNotFound` | Usuario no existe |
| `forcePasswordChange_Success` | Forzar password exitoso |
| `forcePasswordChange_UserNotFound` | Usuario no existe |

---

## 17. RELACION CON OTROS CUs

### 17.1 CUs que Dependen de Usuarios

| CU | Uso |
|----|-----|
| Todos | Campo `creadoPor` en Movimiento referencia al usuario |
| CU31 | Verifica jerarquia de roles para autorizar reverso |
| CU9/CU10 | Usa usuario especial "system_auto" para procesos automaticos |

### 17.2 CUs Relacionados

| CU | Relacion |
|----|----------|
| CU42 | Configuracion de politica de contrasenas |
| CU43 | Este CU |

---

*Documento generado: 2025-12-14*
*Version: 1.0*
